# Spring Security

## Journey

### Console based authentication

- Created project using spring initializer.
- Created dashboard pages and tested by commenting spring security.
  - Created `@Controller` (because `@RestController won't work`) and returned based on URL.
  - Created `dashboard` html inside `resources/templates` folder and returned in `@Controller` class.
  - Created `dashboard_admin` html inside `resources/templates` folder and returned in `@Controller` class.
  - Created `dashboard_guest` html inside `resources/templates` folder and returned in `@Controller` class.
- The above `dashboard` made as landing page after login.
  - Create `SecurityConfig` with custom `SecurityFilterChain` bean.
  - Except `/login` made all url to be authenticated.
  - Customized `successForwardUrl` to land to `dashboard` page after login.
- Tried login with username `user` and password printed in console.
  - Since no authentication manager provided, only password generated by spring can be used for login.
- But I got 405 error saying POST method not supported, looks like `successForwardUrl` redirection to dashboard causing issue.
  - Issue because the redirection happened as POST request to `dashboard` page.
  - So create another `@PostMapping` for dashboard method similar to  `@GetMapping`.
- Success, authentication from login to dashboard page working.

### In-memory based authentication

- In the above method login can be done only with one credential, where password generated by spring. Now it will be moved to code.
- Created custom `UserDetailsService` to return `InMemoryUserDetailsManager` with pre-defined users.
- The goal is to create `UserDetails` object.
- If you see the password, it is hardcoded as encoded value. That encoding is Bcrypt encoder.
- To decode it `BCryptPasswordEncoder` bean is created.
- Also, this time User clas have roles, dashboard admin and guest page is protected by those roles.
- For user don't have access, a new 403 page is returned which is placed in `resources/public/error/`.
- Login page is also customized, by creating a new login html file inside resources/templates folder and customized in `PagesController`.
- Disable CSRF else login wont work.

### Database based authentication

- Upgrading from In-memory based, as the credentials are hardcoded and users and not expandable.
- This project has h2 as database, so complete h2 setup.
- We are changing project context from normal user to employees, going forward login happens via employee id not username. Adjust `usernameParameter` accordingly.
- Created `EmployeeEntity` entity and `EmployeeRepository` DAO.
- Comment in-memory based `UserDetailsService` bean and create new class `FromDatabaseUserDetailsService` for the bean.
- This new `FromDatabaseUserDetailsService` connects to database and create `UserDetails` class.
- To permit `/h2-console` customize `webSecurityCustomizer` bean.